{"ast":null,"code":"var _jsxFileName = \"/home/rimkus/WebstormProjects/UVIID/front/src/Component/Room.tsx\";\nimport * as React from \"react\";\nimport { Button } from \"antd\";\nimport socket from './../Socket';\nimport { withRouter } from 'react-router-dom';\nimport { connect } from 'react-redux';\nimport { AudioOutlined, PhoneOutlined } from \"@ant-design/icons/lib\";\n\nclass Room extends React.Component {\n  constructor(...args) {\n    super(...args);\n    this.state = {\n      videoSrc: \"\",\n      constraint: {\n        video: true,\n        audio: true\n      }\n    };\n\n    this.handleVideo = stream => {\n      socket.setStream(stream);\n      socket.connect(this.props.match.params.id); // @ts-ignore\n\n      document.getElementById(\"local\").srcObject = stream;\n      this.setState({\n        videoSrc: stream\n      }); // Update the state, triggering the component to re-render with the correct stream\n    };\n\n    this.videoError = () => {};\n  }\n\n  componentDidMount() {\n    if (navigator.getUserMedia) {\n      navigator.getUserMedia(this.state.constraint, this.handleVideo, this.videoError);\n    }\n  }\n\n  componentWillUnmount() {\n    socket.disconnect();\n  }\n\n  render() {\n    return /*#__PURE__*/React.createElement(\"div\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 50,\n        columnNumber: 13\n      }\n    }, /*#__PURE__*/React.createElement(\"h1\", {\n      id: 'room',\n      className: \"Middle-layout\",\n      hidden: true,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 51,\n        columnNumber: 17\n      }\n    }, \" Already 5 user in this room\"), /*#__PURE__*/React.createElement(\"video\", {\n      id: \"local\",\n      autoPlay: true,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 52,\n        columnNumber: 25\n      }\n    }), [...this.props.pc.pc.keys()].map(value => {\n      if (value != socket.getSocketId()) return /*#__PURE__*/React.createElement(\"video\", {\n        id: value,\n        autoPlay: true,\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 57,\n          columnNumber: 40\n        }\n      });\n    }), /*#__PURE__*/React.createElement(\"div\", {\n      className: \"center-back\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 60,\n        columnNumber: 17\n      }\n    }, /*#__PURE__*/React.createElement(Button, {\n      shape: \"circle\",\n      className: \"xl-button\",\n      icon: /*#__PURE__*/React.createElement(PhoneOutlined, {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 61,\n          columnNumber: 76\n        }\n      }),\n      onClick: () => {\n        this.props.history.push('/');\n      },\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 61,\n        columnNumber: 21\n      }\n    }), /*#__PURE__*/React.createElement(Button, {\n      shape: \"circle\",\n      className: \"xl-button\",\n      icon: /*#__PURE__*/React.createElement(AudioOutlined, {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 62,\n          columnNumber: 76\n        }\n      }),\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 62,\n        columnNumber: 21\n      }\n    })));\n  }\n\n} // @ts-ignore\n\n\nconst mapStateToProps = ({\n  pc\n}) => {\n  return {\n    pc\n  };\n};\n\nexport default connect(mapStateToProps)(withRouter(Room));\n/*\n\n\nstate = {\n        startDisabled: false,\n        callDisabled: true,\n        hangUpDisabled: true,\n        servers: null,\n        pc1: null,\n        pc2: null,\n        localStream: null\n    };\n\n    localVideoRef = React.createRef<HTMLVideoElement>();\n    remoteVideoRef = React.createRef<HTMLVideoElement>();\n\n    /*    componentDidMount() {\n\n            navigator.mediaDevices.getUserMedia({video: true, audio: true},).then((stream) => {\n                let video = document.querySelector(\"video\");\n                if (video) {\n                    video.srcObject = stream;\n                    video.onloadedmetadata = function (e) {\n                        if (video)\n                            video.play();\n                    };\n                }\n            }).catch((error) => {\n                console.log(error)\n            })\n        }\n\nstart = () => {\n    this.setState({\n        startDisabled: true\n    });\n    navigator.mediaDevices\n        .getUserMedia({\n            audio: true,\n            video: true\n        })\n        .then(this.gotStream)\n        .catch(e => alert(\"getUserMedia() error:\" + e.name));\n};\n\ngotStream = (stream: MediaStream) => {\n    if (this.localVideoRef.current)\n        this.localVideoRef.current.srcObject = stream;\n    this.setState({\n        callDisabled: false,\n        localStream: stream\n    });\n};\n\ncall = () => {\n    this.setState({\n        callDisabled: true,\n        hangUpDisabled: false\n    });\n    let {localStream} = this.state;\n\n    let servers = undefined,\n        pc1 = new RTCPeerConnection(servers),\n        pc2 = new RTCPeerConnection(servers);\n\n    pc1.onicecandidate = e => this.onIceCandidate(pc1, e);\n    pc1.oniceconnectionstatechange = e => console.log(pc1, e);\n\n    pc2.onicecandidate = e => this.onIceCandidate(pc2, e);\n    pc2.oniceconnectionstatechange = e => console.log(pc2, e);\n    pc2.ontrack = this.gotRemoteStream;\n\n    localStream\n        .getTracks()\n        .forEach(track => pc1.addTrack(track, localStream));\n\n\n    pc1\n        .createOffer({\n            offerToReceiveAudio: true,\n            offerToReceiveVideo: true\n        })\n        .then(this.onCreateOfferSuccess, error =>\n            console.error(\n                \"Failed to create session description\",\n                error.toString()\n            )\n        );\n\n    this.setState({\n        servers,\n        pc1,state = {\n        startDisabled: false,\n        callDisabled: true,\n        hangUpDisabled: true,\n        servers: null,\n        pc1: null,\n        pc2: null,\n        localStream: null\n    };\n\n    localVideoRef = React.createRef<HTMLVideoElement>();\n    remoteVideoRef = React.createRef<HTMLVideoElement>();\n\n    /*    componentDidMount() {\n\n            navigator.mediaDevices.getUserMedia({video: true, audio: true},).then((stream) => {\n                let video = document.querySelector(\"video\");\n                if (video) {\n                    video.srcObject = stream;\n                    video.onloadedmetadata = function (e) {\n                        if (video)\n                            video.play();\n                    };\n                }\n            }).catch((error) => {\n                console.log(error)\n            })\n        }\n\n    start = () => {\n        this.setState({\n            startDisabled: true\n        });\n        navigator.mediaDevices\n            .getUserMedia({\n                audio: true,\n                video: true\n            })\n            .then(this.gotStream)\n            .catch(e => alert(\"getUserMedia() error:\" + e.name));\n    };\n\n    gotStream = (stream: MediaStream) => {\n        if (this.localVideoRef.current)\n            this.localVideoRef.current.srcObject = stream;\n        this.setState({\n            callDisabled: false,\n            localStream: stream\n        });\n    };\n\n    call = () => {\n        this.setState({\n            callDisabled: true,\n            hangUpDisabled: false\n        });\n        let {localStream} = this.state;\n\n        let servers = undefined,\n            pc1 = new RTCPeerConnection(servers),\n            pc2 = new RTCPeerConnection(servers);\n\n        pc1.onicecandidate = e => this.onIceCandidate(pc1, e);\n        pc1.oniceconnectionstatechange = e => console.log(pc1, e);\n\n        pc2.onicecandidate = e => this.onIceCandidate(pc2, e);\n        pc2.oniceconnectionstatechange = e => console.log(pc2, e);\n        pc2.ontrack = this.gotRemoteStream;\n\n        localStream\n            .getTracks()\n            .forEach(track => pc1.addTrack(track, localStream));\n\n\n        pc1\n            .createOffer({\n                offerToReceiveAudio: true,\n                offerToReceiveVideo: true\n            })\n            .then(this.onCreateOfferSuccess, error =>\n                console.error(\n                    \"Failed to create session description\",\n                    error.toString()\n                )\n            );\n\n        this.setState({\n            servers,\n            pc1,\n            pc2,\n            localStream\n        });\n    };\n\n    onCreateOfferSuccess = (desc: any) => {\n        let {pc1, pc2} = this.state;\n\n        pc1\n            .setLocalDescription(desc)\n            .then(\n                () =>\n                    console.log(\"pc1 setLocalDescription complete createOffer\"),\n                (error: any) =>\n                    console.error(\n                        \"pc1 Failed to set session description in createOffer\",\n                        error.toString()\n                    )\n            );\n\n        pc2.setRemoteDescription(desc).then(\n            () => {\n                console.log(\"pc2 setRemoteDescription complete createOffer\");\n                pc2\n                    .createAnswer()\n                    .then(this.onCreateAnswerSuccess, (error: any) =>\n                        console.error(\n                            \"pc2 Failed to set session description in createAnswer\",\n                            error.toString()\n                        )\n                    );\n            },\n            (error: any) =>\n                console.error(\n                    \"pc2 Failed to set session description in createOffer\",\n                    error.toString()\n                )\n        );\n    };\n\n    onCreateAnswerSuccess = (desc: RTCSessionDescriptionInit) => {\n        let {pc1, pc2} = this.state;\n\n        pc1\n            .setRemoteDescription(desc)\n            .then(\n                () =>\n                    console.log(\n                        \"pc1 setRemoteDescription complete createAnswer\"\n                    ),\n                (error: any) =>\n                    console.error(\n                        \"pc1 Failed to set session description in onCreateAnswer\",\n                        error.toString()\n                    )\n            );\n\n        pc2\n            .setLocalDescription(desc)\n            .then(\n                () =>\n                    console.log(\n                        \"pc2 setLocalDescription complete createAnswer\"\n                    ),\n                (error: any) =>\n                    console.error(\n                        \"pc2 Failed to set session description in onCreateAnswer\",\n                        error.toString()\n                    )\n            );\n    };\n\n    onIceCandidate = (pc: RTCPeerConnection, event: RTCPeerConnectionIceEvent) => {\n        let {pc1, pc2} = this.state;\n\n        let otherPc = pc === pc1 ? pc2 : pc1;\n\n        otherPc\n            .addIceCandidate(event.candidate)\n            .then(\n                () => console.log(\"addIceCandidate success\"),\n                (error: any) =>\n                    console.error(\n                        \"failed to add ICE Candidate\",\n                        error.toString()\n                    )\n            );\n    };\n\n    hangUp = () => {\n        let {pc1, pc2} = this.state;\n\n        pc1.close();\n        pc2.close();\n\n        this.setState({\n            pc1: null,\n            pc2: null,\n            hangUpDisabled: true,\n            callDisabled: false\n        });\n    };\n        pc2,\n        localStream\n    });\n};\n\nonCreateOfferSuccess = (desc: any) => {\n    let {pc1, pc2} = this.state;\n\n    pc1\n        .setLocalDescription(desc)\n        .then(\n            () =>\n                console.log(\"pc1 setLocalDescription complete createOffer\"),\n            (error: any) =>\n                console.error(\n                    \"pc1 Failed to set session description in createOffer\",\n                    error.toString()\n                )\n        );\n\n    pc2.setRemoteDescription(desc).then(\n        () => {\n            console.log(\"pc2 setRemoteDescription complete createOffer\");\n            pc2\n                .createAnswer()\n                .then(this.onCreateAnswerSuccess, (error: any) =>\n                    console.error(\n                        \"pc2 Failed to set session description in createAnswer\",\n                        error.toString()\n                    )\n                );\n        },\n        (error: any) =>\n            console.error(\n                \"pc2 Failed to set session description in createOffer\",\n                error.toString()\n            )\n    );\n};\n\nonCreateAnswerSuccess = (desc: RTCSessionDescriptionInit) => {\n    let {pc1, pc2} = this.state;\n\n    pc1\n        .setRemoteDescription(desc)\n        .then(\n            () =>\n                console.log(\n                    \"pc1 setRemoteDescription complete createAnswer\"\n                ),\n            (error: any) =>\n                console.error(\n                    \"pc1 Failed to set session description in onCreateAnswer\",\n                    error.toString()\n                )\n        );\n\n    pc2\n        .setLocalDescription(desc)\n        .then(\n            () =>\n                console.log(\n                    \"pc2 setLocalDescription complete createAnswer\"\n                ),\n            (error: any) =>\n                console.error(\n                    \"pc2 Failed to set session description in onCreateAnswer\",\n                    error.toString()\n                )\n        );\n};\n\nonIceCandidate = (pc: RTCPeerConnection, event: RTCPeerConnectionIceEvent) => {\n    let {pc1, pc2} = this.state;\n\n    let otherPc = pc === pc1 ? pc2 : pc1;\n\n    otherPc\n        .addIceCandidate(event.candidate)\n        .then(\n            () => console.log(\"addIceCandidate success\"),\n            (error: any) =>\n                console.error(\n                    \"failed to add ICE Candidate\",\n                    error.toString()\n                )\n        );\n};\n\nhangUp = () => {\n    let {pc1, pc2} = this.state;\n\n    pc1.close();\n    pc2.close();\n\n    this.setState({\n        pc1: null,\n        pc2: null,\n        hangUpDisabled: true,\n        callDisabled: false\n    });\n};\n\n\n    render() {\n        const {startDisabled, callDisabled, hangUpDisabled} = this.state;\n\n        return (\n            <div>\n                <video\n                    ref={this.localVideoRef}\n                    autoPlay\n                    muted\n                    style={{width: \"240px\", height: \"180px\"}}\n                />\n                <video\n                    ref={this.remoteVideoRef}\n                    autoPlay\n                    style={{width: \"240px\", height: \"180px\"}}\n                />\n\n                <div>\n                    <button onClick={this.start} disabled={startDisabled}>\n                        Start\n                    </button>\n                    <button onClick={this.call} disabled={callDisabled}>\n                        Call\n                    </button>\n                    <button onClick={this.hangUp} disabled={hangUpDisabled}>\n                        Hang Up\n                    </button>\n                </div>\n            </div>\n        )\n */","map":{"version":3,"sources":["/home/rimkus/WebstormProjects/UVIID/front/src/Component/Room.tsx"],"names":["React","Button","socket","withRouter","connect","AudioOutlined","PhoneOutlined","Room","Component","state","videoSrc","constraint","video","audio","handleVideo","stream","setStream","props","match","params","id","document","getElementById","srcObject","setState","videoError","componentDidMount","navigator","getUserMedia","componentWillUnmount","disconnect","render","pc","keys","map","value","getSocketId","history","push","mapStateToProps"],"mappings":"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","sourcesContent":["import * as React from \"react\";\nimport {Button, Col, Row} from \"antd\";\nimport {CameraFilled, AudioFilled} from '@ant-design/icons';\nimport socket from './../Socket'\nimport {RouteComponentProps} from \"react-router\";\nimport {withRouter} from 'react-router-dom';\nimport {connect} from 'react-redux';\nimport {IHash} from \"../IHash\";\nimport store from \"../redux/store\";\nimport {AudioOutlined, PhoneOutlined} from \"@ant-design/icons/lib\";\n\ntype param = {\n    id: string\n}\n\ntype roomProps = RouteComponentProps<param> & {\n    pc: any;\n}\n\nclass Room extends React.Component<roomProps> {\n\n    state = {videoSrc: \"\", constraint  : {video: true, audio: true}};\n\n    componentDidMount(): void {\n        if (navigator.getUserMedia) {\n            navigator.getUserMedia(this.state.constraint, this.handleVideo, this.videoError);\n        }\n\n    }\n\n    handleVideo = (stream: MediaStream) => {\n        socket.setStream(stream);\n        socket.connect(this.props.match.params.id);\n\n        // @ts-ignore\n        document.getElementById(\"local\").srcObject = stream;\n        this.setState({videoSrc: stream});\n        // Update the state, triggering the component to re-render with the correct stream\n    }\n\n    videoError = () => {\n    };\n\n    componentWillUnmount(): void {\n        socket.disconnect()\n    }\n\n    render() {\n        return (\n            <div>\n                <h1 id={'room'} className={\"Middle-layout\"} hidden={true}> Already 5 user in this room</h1>\n                        <video id={\"local\"} autoPlay={true}/>\n\n                    {\n                        [...this.props.pc.pc.keys()].map(value => {\n                            if (value != socket.getSocketId())\n                                return <video id={value} autoPlay={true}/>\n                        })\n                    }\n                <div className={\"center-back\"}>\n                    <Button shape={\"circle\"} className={\"xl-button\"} icon={<PhoneOutlined />} onClick={()=> {this.props.history.push('/')}}/>\n                    <Button shape={\"circle\"} className={\"xl-button\"} icon={<AudioOutlined />}/>\n                </div>\n            </div>\n        )\n    }\n}\n\n// @ts-ignore\nconst mapStateToProps = ({pc}) => {\n    return {pc}\n}\n\nexport default connect(mapStateToProps)(withRouter(Room))\n\n\n/*\n\n\nstate = {\n        startDisabled: false,\n        callDisabled: true,\n        hangUpDisabled: true,\n        servers: null,\n        pc1: null,\n        pc2: null,\n        localStream: null\n    };\n\n    localVideoRef = React.createRef<HTMLVideoElement>();\n    remoteVideoRef = React.createRef<HTMLVideoElement>();\n\n    /*    componentDidMount() {\n\n            navigator.mediaDevices.getUserMedia({video: true, audio: true},).then((stream) => {\n                let video = document.querySelector(\"video\");\n                if (video) {\n                    video.srcObject = stream;\n                    video.onloadedmetadata = function (e) {\n                        if (video)\n                            video.play();\n                    };\n                }\n            }).catch((error) => {\n                console.log(error)\n            })\n        }\n\nstart = () => {\n    this.setState({\n        startDisabled: true\n    });\n    navigator.mediaDevices\n        .getUserMedia({\n            audio: true,\n            video: true\n        })\n        .then(this.gotStream)\n        .catch(e => alert(\"getUserMedia() error:\" + e.name));\n};\n\ngotStream = (stream: MediaStream) => {\n    if (this.localVideoRef.current)\n        this.localVideoRef.current.srcObject = stream;\n    this.setState({\n        callDisabled: false,\n        localStream: stream\n    });\n};\n\ncall = () => {\n    this.setState({\n        callDisabled: true,\n        hangUpDisabled: false\n    });\n    let {localStream} = this.state;\n\n    let servers = undefined,\n        pc1 = new RTCPeerConnection(servers),\n        pc2 = new RTCPeerConnection(servers);\n\n    pc1.onicecandidate = e => this.onIceCandidate(pc1, e);\n    pc1.oniceconnectionstatechange = e => console.log(pc1, e);\n\n    pc2.onicecandidate = e => this.onIceCandidate(pc2, e);\n    pc2.oniceconnectionstatechange = e => console.log(pc2, e);\n    pc2.ontrack = this.gotRemoteStream;\n\n    localStream\n        .getTracks()\n        .forEach(track => pc1.addTrack(track, localStream));\n\n\n    pc1\n        .createOffer({\n            offerToReceiveAudio: true,\n            offerToReceiveVideo: true\n        })\n        .then(this.onCreateOfferSuccess, error =>\n            console.error(\n                \"Failed to create session description\",\n                error.toString()\n            )\n        );\n\n    this.setState({\n        servers,\n        pc1,state = {\n        startDisabled: false,\n        callDisabled: true,\n        hangUpDisabled: true,\n        servers: null,\n        pc1: null,\n        pc2: null,\n        localStream: null\n    };\n\n    localVideoRef = React.createRef<HTMLVideoElement>();\n    remoteVideoRef = React.createRef<HTMLVideoElement>();\n\n    /*    componentDidMount() {\n\n            navigator.mediaDevices.getUserMedia({video: true, audio: true},).then((stream) => {\n                let video = document.querySelector(\"video\");\n                if (video) {\n                    video.srcObject = stream;\n                    video.onloadedmetadata = function (e) {\n                        if (video)\n                            video.play();\n                    };\n                }\n            }).catch((error) => {\n                console.log(error)\n            })\n        }\n\n    start = () => {\n        this.setState({\n            startDisabled: true\n        });\n        navigator.mediaDevices\n            .getUserMedia({\n                audio: true,\n                video: true\n            })\n            .then(this.gotStream)\n            .catch(e => alert(\"getUserMedia() error:\" + e.name));\n    };\n\n    gotStream = (stream: MediaStream) => {\n        if (this.localVideoRef.current)\n            this.localVideoRef.current.srcObject = stream;\n        this.setState({\n            callDisabled: false,\n            localStream: stream\n        });\n    };\n\n    call = () => {\n        this.setState({\n            callDisabled: true,\n            hangUpDisabled: false\n        });\n        let {localStream} = this.state;\n\n        let servers = undefined,\n            pc1 = new RTCPeerConnection(servers),\n            pc2 = new RTCPeerConnection(servers);\n\n        pc1.onicecandidate = e => this.onIceCandidate(pc1, e);\n        pc1.oniceconnectionstatechange = e => console.log(pc1, e);\n\n        pc2.onicecandidate = e => this.onIceCandidate(pc2, e);\n        pc2.oniceconnectionstatechange = e => console.log(pc2, e);\n        pc2.ontrack = this.gotRemoteStream;\n\n        localStream\n            .getTracks()\n            .forEach(track => pc1.addTrack(track, localStream));\n\n\n        pc1\n            .createOffer({\n                offerToReceiveAudio: true,\n                offerToReceiveVideo: true\n            })\n            .then(this.onCreateOfferSuccess, error =>\n                console.error(\n                    \"Failed to create session description\",\n                    error.toString()\n                )\n            );\n\n        this.setState({\n            servers,\n            pc1,\n            pc2,\n            localStream\n        });\n    };\n\n    onCreateOfferSuccess = (desc: any) => {\n        let {pc1, pc2} = this.state;\n\n        pc1\n            .setLocalDescription(desc)\n            .then(\n                () =>\n                    console.log(\"pc1 setLocalDescription complete createOffer\"),\n                (error: any) =>\n                    console.error(\n                        \"pc1 Failed to set session description in createOffer\",\n                        error.toString()\n                    )\n            );\n\n        pc2.setRemoteDescription(desc).then(\n            () => {\n                console.log(\"pc2 setRemoteDescription complete createOffer\");\n                pc2\n                    .createAnswer()\n                    .then(this.onCreateAnswerSuccess, (error: any) =>\n                        console.error(\n                            \"pc2 Failed to set session description in createAnswer\",\n                            error.toString()\n                        )\n                    );\n            },\n            (error: any) =>\n                console.error(\n                    \"pc2 Failed to set session description in createOffer\",\n                    error.toString()\n                )\n        );\n    };\n\n    onCreateAnswerSuccess = (desc: RTCSessionDescriptionInit) => {\n        let {pc1, pc2} = this.state;\n\n        pc1\n            .setRemoteDescription(desc)\n            .then(\n                () =>\n                    console.log(\n                        \"pc1 setRemoteDescription complete createAnswer\"\n                    ),\n                (error: any) =>\n                    console.error(\n                        \"pc1 Failed to set session description in onCreateAnswer\",\n                        error.toString()\n                    )\n            );\n\n        pc2\n            .setLocalDescription(desc)\n            .then(\n                () =>\n                    console.log(\n                        \"pc2 setLocalDescription complete createAnswer\"\n                    ),\n                (error: any) =>\n                    console.error(\n                        \"pc2 Failed to set session description in onCreateAnswer\",\n                        error.toString()\n                    )\n            );\n    };\n\n    onIceCandidate = (pc: RTCPeerConnection, event: RTCPeerConnectionIceEvent) => {\n        let {pc1, pc2} = this.state;\n\n        let otherPc = pc === pc1 ? pc2 : pc1;\n\n        otherPc\n            .addIceCandidate(event.candidate)\n            .then(\n                () => console.log(\"addIceCandidate success\"),\n                (error: any) =>\n                    console.error(\n                        \"failed to add ICE Candidate\",\n                        error.toString()\n                    )\n            );\n    };\n\n    hangUp = () => {\n        let {pc1, pc2} = this.state;\n\n        pc1.close();\n        pc2.close();\n\n        this.setState({\n            pc1: null,\n            pc2: null,\n            hangUpDisabled: true,\n            callDisabled: false\n        });\n    };\n        pc2,\n        localStream\n    });\n};\n\nonCreateOfferSuccess = (desc: any) => {\n    let {pc1, pc2} = this.state;\n\n    pc1\n        .setLocalDescription(desc)\n        .then(\n            () =>\n                console.log(\"pc1 setLocalDescription complete createOffer\"),\n            (error: any) =>\n                console.error(\n                    \"pc1 Failed to set session description in createOffer\",\n                    error.toString()\n                )\n        );\n\n    pc2.setRemoteDescription(desc).then(\n        () => {\n            console.log(\"pc2 setRemoteDescription complete createOffer\");\n            pc2\n                .createAnswer()\n                .then(this.onCreateAnswerSuccess, (error: any) =>\n                    console.error(\n                        \"pc2 Failed to set session description in createAnswer\",\n                        error.toString()\n                    )\n                );\n        },\n        (error: any) =>\n            console.error(\n                \"pc2 Failed to set session description in createOffer\",\n                error.toString()\n            )\n    );\n};\n\nonCreateAnswerSuccess = (desc: RTCSessionDescriptionInit) => {\n    let {pc1, pc2} = this.state;\n\n    pc1\n        .setRemoteDescription(desc)\n        .then(\n            () =>\n                console.log(\n                    \"pc1 setRemoteDescription complete createAnswer\"\n                ),\n            (error: any) =>\n                console.error(\n                    \"pc1 Failed to set session description in onCreateAnswer\",\n                    error.toString()\n                )\n        );\n\n    pc2\n        .setLocalDescription(desc)\n        .then(\n            () =>\n                console.log(\n                    \"pc2 setLocalDescription complete createAnswer\"\n                ),\n            (error: any) =>\n                console.error(\n                    \"pc2 Failed to set session description in onCreateAnswer\",\n                    error.toString()\n                )\n        );\n};\n\nonIceCandidate = (pc: RTCPeerConnection, event: RTCPeerConnectionIceEvent) => {\n    let {pc1, pc2} = this.state;\n\n    let otherPc = pc === pc1 ? pc2 : pc1;\n\n    otherPc\n        .addIceCandidate(event.candidate)\n        .then(\n            () => console.log(\"addIceCandidate success\"),\n            (error: any) =>\n                console.error(\n                    \"failed to add ICE Candidate\",\n                    error.toString()\n                )\n        );\n};\n\nhangUp = () => {\n    let {pc1, pc2} = this.state;\n\n    pc1.close();\n    pc2.close();\n\n    this.setState({\n        pc1: null,\n        pc2: null,\n        hangUpDisabled: true,\n        callDisabled: false\n    });\n};\n\n\n    render() {\n        const {startDisabled, callDisabled, hangUpDisabled} = this.state;\n\n        return (\n            <div>\n                <video\n                    ref={this.localVideoRef}\n                    autoPlay\n                    muted\n                    style={{width: \"240px\", height: \"180px\"}}\n                />\n                <video\n                    ref={this.remoteVideoRef}\n                    autoPlay\n                    style={{width: \"240px\", height: \"180px\"}}\n                />\n\n                <div>\n                    <button onClick={this.start} disabled={startDisabled}>\n                        Start\n                    </button>\n                    <button onClick={this.call} disabled={callDisabled}>\n                        Call\n                    </button>\n                    <button onClick={this.hangUp} disabled={hangUpDisabled}>\n                        Hang Up\n                    </button>\n                </div>\n            </div>\n        )\n */\n"]},"metadata":{},"sourceType":"module"}
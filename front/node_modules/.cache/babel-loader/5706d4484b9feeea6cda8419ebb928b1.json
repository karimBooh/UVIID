{"ast":null,"code":"import io from 'socket.io-client';\n\nclass Socket {\n  constructor() {\n    this.socket = void 0;\n    this.pc = void 0;\n  }\n\n  send() {\n    this.socket.emit('message', 'hi');\n  }\n\n  connect(room) {\n    if (this.socket && this.socket.connected) {\n      return;\n    }\n\n    this.socket = io('http://localhost:8080');\n    return new Promise(resolve => {\n      this.socket.on('connect', () => {\n        let socketId = this.socket.io.engine.id;\n        this.socket.emit('subscribe', {\n          room: room,\n          socketId: socketId\n        });\n        this.socket.on('new user', data => {\n          this.socket.emit('newUserStart', {\n            to: data.socketId,\n            sender: socketId\n          });\n          this.pc.push(data.socketId);\n          init(true, data.socketId);\n        });\n        this.socket.on('newUserStart', data => {\n          this.pc.push(data.sender);\n          init(false, data.sender);\n        });\n        this.socket.on('ice candidates', async data => {\n          data.candidate ? await this.pc[data.sender].addIceCandidate(new RTCIceCandidate(data.candidate)) : '';\n        });\n        resolve(this.socket);\n      });\n    });\n  }\n\n  disconnect() {\n    this.socket.emit('disconnect');\n    this.socket.close();\n  }\n\n}\n\nconst instance = new Socket();\nexport default instance;","map":{"version":3,"sources":["/home/rimkus/WebstormProjects/UVIID/front/src/Socket.tsx"],"names":["io","Socket","socket","pc","send","emit","connect","room","connected","Promise","resolve","on","socketId","engine","id","data","to","sender","push","init","candidate","addIceCandidate","RTCIceCandidate","disconnect","close","instance"],"mappings":"AAAA,OAAOA,EAAP,MAAe,kBAAf;;AAGA,MAAOC,MAAP,CAAc;AAAA;AAAA,SACFC,MADE;AAAA,SAEFC,EAFE;AAAA;;AAIVC,EAAAA,IAAI,GAAG;AACH,SAAKF,MAAL,CAAYG,IAAZ,CAAiB,SAAjB,EAA4B,IAA5B;AACH;;AAEDC,EAAAA,OAAO,CAACC,IAAD,EAAgB;AACnB,QAAI,KAAKL,MAAL,IAAe,KAAKA,MAAL,CAAYM,SAA/B,EAA0C;AACtC;AACH;;AACD,SAAKN,MAAL,GAAcF,EAAE,CAAC,uBAAD,CAAhB;AACA,WAAO,IAAIS,OAAJ,CAAYC,OAAO,IAAI;AAC1B,WAAKR,MAAL,CAAYS,EAAZ,CAAe,SAAf,EAA0B,MAAM;AAC5B,YAAIC,QAAQ,GAAG,KAAKV,MAAL,CAAYF,EAAZ,CAAea,MAAf,CAAsBC,EAArC;AAEA,aAAKZ,MAAL,CAAYG,IAAZ,CAAiB,WAAjB,EAA8B;AAC1BE,UAAAA,IAAI,EAAEA,IADoB;AAE1BK,UAAAA,QAAQ,EAAEA;AAFgB,SAA9B;AAKA,aAAKV,MAAL,CAAYS,EAAZ,CAAe,UAAf,EAA4BI,IAAD,IAAa;AACpC,eAAKb,MAAL,CAAYG,IAAZ,CAAiB,cAAjB,EAAiC;AAACW,YAAAA,EAAE,EAACD,IAAI,CAACH,QAAT;AAAmBK,YAAAA,MAAM,EAACL;AAA1B,WAAjC;AACA,eAAKT,EAAL,CAAQe,IAAR,CAAaH,IAAI,CAACH,QAAlB;AACAO,UAAAA,IAAI,CAAC,IAAD,EAAOJ,IAAI,CAACH,QAAZ,CAAJ;AACH,SAJD;AAOA,aAAKV,MAAL,CAAYS,EAAZ,CAAe,cAAf,EAAgCI,IAAD,IAAc;AACzC,eAAKZ,EAAL,CAAQe,IAAR,CAAaH,IAAI,CAACE,MAAlB;AACAE,UAAAA,IAAI,CAAC,KAAD,EAAQJ,IAAI,CAACE,MAAb,CAAJ;AACH,SAHD;AAKA,aAAKf,MAAL,CAAYS,EAAZ,CAAe,gBAAf,EAAiC,MAAOI,IAAP,IAAkB;AAC/CA,UAAAA,IAAI,CAACK,SAAL,GAAiB,MAAM,KAAKjB,EAAL,CAAQY,IAAI,CAACE,MAAb,EAAqBI,eAArB,CAAqC,IAAIC,eAAJ,CAAoBP,IAAI,CAACK,SAAzB,CAArC,CAAvB,GAAmG,EAAnG;AACH,SAFD;AAGAV,QAAAA,OAAO,CAAC,KAAKR,MAAN,CAAP;AACH,OAxBD;AAyBH,KA1BM,CAAP;AA2BH;;AAEDqB,EAAAA,UAAU,GAAG;AACT,SAAKrB,MAAL,CAAYG,IAAZ,CAAiB,YAAjB;AACA,SAAKH,MAAL,CAAYsB,KAAZ;AACH;;AA7CS;;AAgDd,MAAMC,QAAQ,GAAG,IAAIxB,MAAJ,EAAjB;AACA,eAAewB,QAAf","sourcesContent":["import io from 'socket.io-client'\n\n\nclass  Socket {\n    private socket : any;\n    private pc : RTCPeerConnection[];\n\n    send() {\n        this.socket.emit('message', 'hi');\n    }\n\n    connect(room : string) {\n        if (this.socket && this.socket.connected) {\n            return ;\n        }\n        this.socket = io('http://localhost:8080');\n        return new Promise(resolve => {\n            this.socket.on('connect', () => {\n                let socketId = this.socket.io.engine.id;\n\n                this.socket.emit('subscribe', {\n                    room: room,\n                    socketId: socketId\n                });\n\n                this.socket.on('new user', (data: any)=>{\n                    this.socket.emit('newUserStart', {to:data.socketId, sender:socketId});\n                    this.pc.push(data.socketId);\n                    init(true, data.socketId);\n                });\n\n\n                this.socket.on('newUserStart', (data : any)=>{\n                    this.pc.push(data.sender);\n                    init(false, data.sender);\n                });\n\n                this.socket.on('ice candidates', async (data:any)=>{\n                    data.candidate ? await this.pc[data.sender].addIceCandidate(new RTCIceCandidate(data.candidate)) : '';\n                });\n                resolve(this.socket);\n            });\n        });\n    }\n\n    disconnect() {\n        this.socket.emit('disconnect');\n        this.socket.close();\n    }\n}\n\nconst instance = new Socket();\nexport default instance\n"]},"metadata":{},"sourceType":"module"}